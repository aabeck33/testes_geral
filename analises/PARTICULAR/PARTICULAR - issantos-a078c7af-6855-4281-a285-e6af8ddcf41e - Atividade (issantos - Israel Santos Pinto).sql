SELECT CASE ATI.FGTASKTYPE WHEN 3 THEN '' ELSE AB.NMIDTASK END AS IDPROJECT, CASE ATI.FGTASKTYPE WHEN 3 THEN '' ELSE AB.NMTASK END AS NMPROJECT, ATI.NMIDTASK, ATI.NMTASK, COALESCE(ATI.QTACTPERC, 0) AS NMACTPERC, ATI.DTPLANST, ATI.DTREPLST, ATI.NMWBS, CASE WHEN ATI.FGPHASE=6 THEN CAST ('#{107788}' AS VARCHAR(255)) WHEN ATI.FGPHASE=7 THEN CAST ('#{104230}' AS VARCHAR(255)) WHEN ATI.FGAPPROVAL=3 THEN CAST ('#{100761}' AS VARCHAR(255)) WHEN ATI.FGPHASE=1 THEN CAST ('#{103649}' AS VARCHAR(255)) WHEN (ATI.FGPHASE=2 AND ATI.FGCLOSING=1) OR ATI.FGPHASE=5 THEN CAST ('#{100263}' AS VARCHAR(255)) WHEN ATI.FGPHASE=2 AND ATI.FGCLOSING=3 THEN CAST ('#{100761}' AS VARCHAR(255)) WHEN ATI.FGPHASE=2 AND ATI.DTACTST IS NULL THEN CAST ('#{201912}' AS VARCHAR(255)) WHEN ATI.FGPHASE=2 AND ATI.DTACTST IS NOT NULL THEN CAST ('#{100481}' AS VARCHAR(255)) WHEN ATI.FGPHASE=3 THEN CAST ('#{100303}' AS VARCHAR(255)) WHEN ATI.FGPHASE=4 THEN CAST ('#{101237}' AS VARCHAR(255)) WHEN ATI.FGPHASE=8 THEN CAST ('#{200381}' AS VARCHAR(255)) END AS PHASETASK, CASE ATI.FGTASKTYPE WHEN 3 THEN '' ELSE CASE WHEN AB.FGPHASE=6 THEN CAST ('#{107788}' AS VARCHAR(255)) WHEN AB.FGPHASE=7 THEN CAST ('#{104230}' AS VARCHAR(255)) WHEN AB.FGAPPROVAL=3 THEN CAST ('#{100761}' AS VARCHAR(255)) WHEN AB.FGPHASE=1 THEN CAST ('#{103649}' AS VARCHAR(255)) WHEN (AB.FGPHASE=2 AND AB.FGCLOSING=1) OR AB.FGPHASE=5 THEN CAST ('#{100263}' AS VARCHAR(255)) WHEN AB.FGPHASE=2 AND AB.FGCLOSING=3 THEN CAST ('#{100761}' AS VARCHAR(255)) WHEN AB.FGPHASE=2 AND AB.DTACTST IS NULL THEN CAST ('#{201912}' AS VARCHAR(255)) WHEN AB.FGPHASE=2 AND AB.DTACTST IS NOT NULL THEN CAST ('#{100481}' AS VARCHAR(255)) WHEN AB.FGPHASE=3 THEN CAST ('#{100303}' AS VARCHAR(255)) WHEN AB.FGPHASE=4 THEN CAST ('#{101237}' AS VARCHAR(255)) WHEN AB.FGPHASE=8 THEN CAST ('#{200381}' AS VARCHAR(255)) END END AS PHASEPROJECT, ATI.DTACTST, ATI.DTPLANEND, ATI.DTREPLEND, ATI.DTACTEND, COALESCE(ATI.QTPLANDUR, 0) AS NMPLANDUR, COALESCE(ATI.QTREPLDUR, 0) AS NMREPLDUR, COALESCE(ATI.QTACTDUR, 0) AS NMACTDUR, (TB.IDTASKTYPE + ' - ' + TB.NMTASKTYPE) AS PROJECTTYPE, (DP.IDDEPARTMENT + ' - ' + DP.NMDEPARTMENT) AS PROJECTDEPT, (USA.IDUSER + ' - ' + USA.NMUSER) AS PROJECTRESP, (TA.IDTASKTYPE + ' - ' + TA.NMTASKTYPE) AS TASKTYPE, (AR.IDDEPARTMENT + ' - ' + AR.NMDEPARTMENT) AS TASKDEPT, (US.IDUSER + ' - ' + US.NMUSER) AS TASKRESP, 1 AS CDTASK, /* QTD HORAS */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE CAST( ATV.QTPLANMINUTES AS NUMERIC(28,12)) * CAST( 60*1000 AS NUMERIC(28,12)) END AS NUMERIC(28,12)) AS QTPLANMINUTES, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE CAST( ATV.QTREPLMINUTES AS NUMERIC(28,12)) * CAST( 60*1000 AS NUMERIC(28,12)) END AS NUMERIC(28,12)) AS QTREPLMINUTES, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE CAST( ATV.QTACTMINUTES AS NUMERIC(28,12)) * CAST( 60*1000 AS NUMERIC(28,12)) END AS NUMERIC(28,12)) AS QTACTMINUTES, /* CUSTO DO RECURSO */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNPLANHOURS, 0) END AS NUMERIC(28,12)) AS MNPLANHOURS, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNREPLHOURS, 0) END AS NUMERIC(28,12)) AS MNREPLHOURS, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNACTHOURS, 0) END AS NUMERIC(28,12)) AS MNACTHOURS, /* CUSTO */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNPLANCOST, 0) END AS NUMERIC(28,12)) AS MNPLANCOST, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNREPLCOST, 0) END AS NUMERIC(28,12)) AS MNREPLCOST, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNACTCOST, 0) END AS NUMERIC(28,12)) AS MNACTCOST, /* RECEITA DO RECURSO */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNPLANHOURSREVENUE, 0) END AS NUMERIC(28,12)) AS MNPLANHOURSREVENUE, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNREPLHOURSREVENUE, 0) END AS NUMERIC(28,12)) AS MNREPLHOURSREVENUE, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNACTHOURSREVENUE, 0) END AS NUMERIC(28,12)) AS MNACTHOURSREVENUE, /* RECEITA */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNPLANREVENUE, 0) END AS NUMERIC(28,12)) AS MNPLANREVENUE, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNREPLREVENUE, 0) END AS NUMERIC(28,12)) AS MNREPLREVENUE, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE COALESCE(ATV.MNACTREVENUE, 0) END AS NUMERIC(28,12)) AS MNACTREVENUE, /* CUSTO TOTAL */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE (COALESCE( ATV.MNPLANHOURS,0) + COALESCE( ATV.MNPLANCOST,0)) END AS NUMERIC(28,12)) AS MNPLANTOTCOST, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE (COALESCE( ATV.MNREPLHOURS,0) + COALESCE( ATV.MNREPLCOST,0)) END AS NUMERIC(28,12)) AS MNREPLTOTCOST, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE (COALESCE( ATV.MNACTHOURS,0) + COALESCE( ATV.MNACTCOST,0)) END AS NUMERIC(28,12)) AS MNACTTOTCOST, /* RECEITA TOTAL */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE (COALESCE( ATV.MNPLANHOURSREVENUE,0) + COALESCE( ATV.MNPLANREVENUE,0)) END AS NUMERIC(28,12)) AS MNPLANTOTREVENUE, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE (COALESCE( ATV.MNREPLHOURSREVENUE,0) + COALESCE( ATV.MNREPLREVENUE,0)) END AS NUMERIC(28,12)) AS MNREPLTOTREVENUE, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE (COALESCE( ATV.MNACTHOURSREVENUE,0) + COALESCE( ATV.MNACTREVENUE,0)) END AS NUMERIC(28,12)) AS MNACTTOTREVENUE, /* RESULTADO */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE ((COALESCE(ATV.MNPLANHOURSREVENUE,0) + COALESCE(ATV.MNPLANREVENUE,0))-(COALESCE(ATV.MNPLANHOURS,0) + COALESCE(ATV.MNPLANCOST,0))) END AS NUMERIC(28,12)) AS PLANRESULT, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE ((COALESCE(ATV.MNREPLHOURSREVENUE,0) + COALESCE(ATV.MNREPLREVENUE,0))-(COALESCE(ATV.MNREPLHOURS,0) + COALESCE(ATV.MNREPLCOST,0))) END AS NUMERIC(28,12)) AS REPLRESULT, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE ((COALESCE(ATV.MNACTHOURSREVENUE,0) + COALESCE(ATV.MNACTREVENUE,0))-(COALESCE(ATV.MNACTHOURS,0) + COALESCE(ATV.MNACTCOST,0))) END AS NUMERIC(28,12)) AS ACTRESULT, /* RENTABILIDADE $ */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE ((COALESCE(ATV.MNPLANREVENUE,0) + COALESCE(ATV.MNPLANHOURSREVENUE, 0)) - (COALESCE(ATV.MNPLANCOST,0) + COALESCE(ATV.MNPLANHOURS, 0))) END AS NUMERIC(28,12)) AS MNPLANHOURSRENT, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE ((COALESCE(ATV.MNREPLREVENUE,0) + COALESCE(ATV.MNREPLHOURSREVENUE, 0)) - (COALESCE(ATV.MNREPLCOST,0) + COALESCE(ATV.MNREPLHOURS, 0))) END AS NUMERIC(28,12)) AS MNREPLHOURSRENT, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE ((COALESCE(ATV.MNACTREVENUE,0) + COALESCE(ATV.MNACTHOURSREVENUE, 0)) - (COALESCE(ATV.MNACTCOST,0) + COALESCE(ATV.MNACTHOURS, 0))) END AS NUMERIC(28,12)) AS MNACTHOURSRENT, /* RENTABILIDADE % */ CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE CASE WHEN (COALESCE(ATV.MNPLANREVENUE,0) + COALESCE(ATV.MNPLANHOURSREVENUE,0)) <> 0 THEN (((COALESCE(ATV.MNPLANREVENUE,0) + COALESCE(ATV.MNPLANHOURSREVENUE,0)) - (COALESCE(ATV.MNPLANCOST,0) + COALESCE(ATV.MNPLANHOURS,0))) / (COALESCE(ATV.MNPLANREVENUE,0) + COALESCE(ATV.MNPLANHOURSREVENUE,0))) * 100 ELSE NULL END END AS NUMERIC(28,12)) AS MNPLANHOURSRENTPERCENT, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE CASE WHEN (COALESCE(ATV.MNREPLREVENUE,0) + COALESCE(ATV.MNREPLHOURSREVENUE,0)) <> 0 THEN (((COALESCE(ATV.MNREPLREVENUE,0) + COALESCE(ATV.MNREPLHOURSREVENUE,0)) - (COALESCE(ATV.MNREPLCOST,0) + COALESCE(ATV.MNREPLHOURS,0))) / (COALESCE(ATV.MNREPLREVENUE,0) + COALESCE(ATV.MNREPLHOURSREVENUE,0))) * 100 ELSE NULL END END AS NUMERIC(28,12)) AS MNREPLHOURSRENTPERCENT, CAST( CASE WHEN ((AB.CDTASK IN (6618,6767,6794,6829,6867,7076,7079,7081,7089,7852,7853,7935,8094,8556,8578,8604,8610,8622,8631,8659,8660,8661,8662,8663,8666,8667,8668,8688,8710,8719,8730,8731,8742,9171,9210,9241,9242,9243,9244,9280,10322,10809,10973,11790,11855,11919,12201,12346,12689,13913,14646,14647,14648,14649,14705,14708,14721,14723,14725,14730,14791,15772,15852,16253,16264,16296,16307,16324,16357,16435,16552,16952,17211,17226,17360,17387,17416,18194,18269,18358,18475,18886,19343,19839,20755,20757,20759,20778,21174,21178,21179,21182,21183,21184,21185,21245,21256,21267,21268,21279,21291,21302,21303,21314,21326,21327,21339,21340,21351,21352,21364,21495,21517,21528,21539,21560,21571,21582,21593,21958,21975,21978,21981))) THEN 0 ELSE CASE WHEN (COALESCE(ATV.MNACTREVENUE,0) + COALESCE(ATV.MNACTHOURSREVENUE,0)) <> 0 THEN (((COALESCE(ATV.MNACTREVENUE,0) + COALESCE(ATV.MNACTHOURSREVENUE,0)) - (COALESCE(ATV.MNACTCOST,0) + COALESCE(ATV.MNACTHOURS,0))) / (COALESCE(ATV.MNACTREVENUE,0) + COALESCE(ATV.MNACTHOURSREVENUE,0))) * 100 ELSE NULL END END AS NUMERIC(28,12)) AS MNACTHOURSRENTPERCENT, CASE WHEN ATI.FGOUTDATED=1 AND ATI.FGPHASE NOT IN (6,7) THEN 'Desatualizado' WHEN ATI.FGPHASE=5 AND ATI.CDTASK <> ATI.CDBASETASK THEN NULL WHEN (ATI.FGPHASE IN (8,5) OR ATI.FGPHASE=2 AND ATI.FGCLOSING=1 OR ATI.FGREVISION IN (2,3)) AND ATI.FGAPPROVAL IS NOT NULL AND ATI.CDTASK=ATI.CDBASETASK THEN STATUSAPROV.NMDEADLINE WHEN (AD1.IDPARAM='1' AND AD2.IDPARAM='2' AND ATI.FGPHASE NOT IN (6,7,1)) THEN CASE WHEN (ATI.DTACTST IS NULL) THEN CASE WHEN (COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) < ATI.DTSCHEDULEDEND OR COALESCE(ATI.DTPLANST, ATI.DTREPLST) < <!%TODAY%>) THEN 'Em atraso' WHEN (COALESCE(ATI.DTPLANST, ATI.DTREPLST)=<!%TODAY%>) THEN 'Em dia' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NULL) THEN CASE WHEN (COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) < ATI.DTSCHEDULEDEND OR COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) < <!%TODAY%>) THEN 'Em atraso' ELSE 'Em dia' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NOT NULL) THEN CASE WHEN (ATI.DTACTEND > COALESCE(ATI.DTPLANEND, ATI.DTREPLEND)) THEN 'Em atraso' ELSE 'Em dia' END END WHEN (AD1.IDPARAM='2' AND AD2.IDPARAM='2' AND ATI.FGPHASE NOT IN (6,7,1)) THEN CASE WHEN (ATI.DTACTST IS NULL) THEN CASE WHEN (<!%TODAY%>=ATI.DTSCHEDULEDST) THEN 'Em dia' WHEN (<!%TODAY%> > ATI.DTSCHEDULEDST) THEN 'Em atraso' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NULL) THEN CASE WHEN (ATI.DTSCHEDULEDEND <= ATI.DTREPLEND AND ATI.DTREPLEND >= <!%TODAY%>) THEN 'Em dia' ELSE 'Em atraso' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NOT NULL) THEN CASE WHEN (ATI.DTACTEND <= ATI.DTREPLEND) THEN 'Em dia' ELSE 'Em atraso' END END WHEN (AD1.IDPARAM='1' AND AD2.IDPARAM='3' AND ATI.FGPHASE NOT IN (6,7,1)) THEN CASE WHEN (ATI.DTACTST IS NULL) THEN CASE WHEN (COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) < COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) OR COALESCE(ATI.DTPLANST, ATI.DTREPLST) < <!%TODAY%>) THEN 'Em atraso' WHEN (COALESCE(ATI.DTPLANST, ATI.DTREPLST)=<!%TODAY%>) THEN 'Em dia' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NULL) THEN CASE WHEN (COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) < COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) OR COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) < <!%TODAY%>) THEN 'Em atraso' ELSE 'Em dia' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NOT NULL) THEN CASE WHEN (ATI.DTACTEND > COALESCE(ATI.DTPLANEND, ATI.DTREPLEND)) THEN 'Em atraso' ELSE 'Em dia' END END WHEN (AD1.IDPARAM='2' AND AD2.IDPARAM='3' AND ATI.FGPHASE NOT IN (6,7,1)) THEN CASE WHEN (ATI.DTACTST IS NULL) THEN CASE WHEN (<!%TODAY%>=ATI.DTREPLST) THEN 'Em dia' WHEN (<!%TODAY%> > ATI.DTREPLST) THEN 'Em atraso' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NULL) THEN CASE WHEN (ATI.DTREPLEND <= ATI.DTREPLEND AND ATI.DTREPLEND >= <!%TODAY%>) THEN 'Em dia' ELSE 'Em atraso' END WHEN (ATI.DTACTST IS NOT NULL AND ATI.DTACTEND IS NOT NULL) THEN CASE WHEN (ATI.DTACTEND <= ATI.DTREPLEND) THEN 'Em dia' ELSE 'Em atraso' END END WHEN (AD1.IDPARAM='1' AND AD2.IDPARAM='1' AND ATI.FGPHASE NOT IN (6,7,1)) THEN CASE WHEN (ATI.FGPHASE=2 AND ATI.DTACTEND IS NULL) THEN CASE WHEN (<!%TODAY%> < COALESCE(ATI.DTPLANST, ATI.DTREPLST)) THEN NULL WHEN (COALESCE(ATI.DTPLANEND, ATI.DTREPLEND) <= <!%TODAY%> AND COALESCE(ATI.QTACTPERC, 0) >= 100) THEN 'Em dia' WHEN (ATI.QTACTPERC >= ((dbo.SEF_QT_WK_DAYS_PERIOD (CONVERT(DATETIME, COALESCE(ATI.DTPLANST, ATI.DTREPLST)), CONVERT(DATETIME, <!%TODAY%>), NULL) * 100) / CASE WHEN (dbo.SEF_QT_WK_DAYS_PERIOD (CONVERT(DATETIME, COALESCE(ATI.DTPLANST, ATI.DTREPLST)), CONVERT(DATETIME, COALESCE(ATI.DTPLANEND, ATI.DTREPLEND)), NULL)=0) THEN 1 ELSE dbo.SEF_QT_WK_DAYS_PERIOD (CONVERT(DATETIME, COALESCE(ATI.DTPLANST, ATI.DTREPLST)), CONVERT(DATETIME, COALESCE(ATI.DTPLANEND, ATI.DTREPLEND)), NULL) END) OR ((COALESCE(ATI.DTPLANST, ATI.DTREPLST) <= <!%TODAY%> OR <!%TODAY%>=COALESCE(ATI.DTPLANST, ATI.DTREPLST)) AND COALESCE(ATI.QTACTPERC, 0) >= 100)) THEN 'Em dia' ELSE 'Em atraso' END ELSE CASE WHEN (ATI.DTACTEND > COALESCE(ATI.DTPLANEND, ATI.DTREPLEND)) THEN 'Em atraso' ELSE 'Em dia' END END WHEN (AD1.IDPARAM='2' AND AD2.IDPARAM='1' AND ATI.FGPHASE NOT IN (6,7,1)) THEN CASE WHEN (ATI.FGPHASE=2 AND ATI.DTACTEND IS NULL) THEN CASE WHEN (<!%TODAY%> < ATI.DTREPLST) THEN 'Em dia' WHEN (ATI.QTACTPERC >= ((dbo.SEF_QT_WK_DAYS_PERIOD (CONVERT(DATETIME, ATI.DTREPLST), CONVERT(DATETIME, <!%TODAY%>), NULL) * 100) / CASE WHEN (dbo.SEF_QT_WK_DAYS_PERIOD (CONVERT(DATETIME, ATI.DTREPLST), CONVERT(DATETIME, ATI.DTREPLEND), NULL)=0) THEN 1 ELSE dbo.SEF_QT_WK_DAYS_PERIOD (CONVERT(DATETIME, ATI.DTREPLST), CONVERT(DATETIME, ATI.DTREPLEND), NULL) END) OR ((ATI.DTREPLEND <= <!%TODAY%> OR <!%TODAY%>=ATI.DTREPLST) AND COALESCE(ATI.QTACTPERC, 0) >= 100)) THEN 'Em dia' ELSE 'Em atraso' END ELSE CASE WHEN (ATI.DTACTEND <= ATI.DTREPLEND) THEN 'Em dia' ELSE 'Em atraso' END END END AS FGDEADLINE FROM PRTASKTYPE TB, ADDEPARTMENT DP, ADUSER USA, PRTASK AB LEFT JOIN (SELECT DISTINCT PVIEW.PR_CDTASK FROM (SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDDEPARTMENT=ACCVIEW.CDDEPARTMENT  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=1 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDPOSITION=ACCVIEW.CDPOSITION  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=2 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDDEPARTMENT=ACCVIEW.CDDEPARTMENT AND UDP.CDPOSITION=ACCVIEW.CDPOSITION  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=3 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, ACCVIEW.CDUSER FROM PRTASKACCESS ACCVIEW  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=4 AND ACCVIEW.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, TMM.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADTEAMUSER TMM ON TMM.CDTEAM=ACCVIEW.CDTEAM  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=5 AND TMM.CDUSER=15611) PVIEW WHERE 1=1) PRTASKSECURITY ON PRTASKSECURITY.PR_CDTASK=AB.CDBASETASK AND AB.FGRESTRICT=1, PRTASK ATI LEFT OUTER JOIN PRTASKTYPE TA ON (ATI.CDTASKTYPE=TA.CDTASKTYPE), ADUSER US, PRTASKFINANCES ATV, ADDEPARTMENT AR, ADPARAMS AD1, ADPARAMS AD2, (SELECT CASE WHEN (( GNA.DTDEADLINE > (DATEADD(DAY, COALESCE((SELECT QTDAYS FROM ADMAILTASKEXEC WHERE CDMAILTASKEXEC=(SELECT TASK.CDAHEAD FROM ADMAILTASKREL TASK WHERE TASK.CDMAILTASKREL=(SELECT TBL.CDMAILTASKSETTINGS FROM CONOTIFICATION TBL))), 0), CAST(<!%TODAY%> AS DATETIME)))) OR (GNA.DTDEADLINE IS NULL)) THEN 1 WHEN (( GNA.DTDEADLINE=CAST(<!%TODAY%> AS DATETIME)) OR (GNA.DTDEADLINE > CAST(<!%TODAY%> AS DATETIME))) THEN 2 ELSE 3  END AS FGDEADLINE,  CASE WHEN (( GNA.DTDEADLINE > (DATEADD(DAY, COALESCE((SELECT QTDAYS FROM ADMAILTASKEXEC WHERE CDMAILTASKEXEC=(SELECT TASK.CDAHEAD FROM ADMAILTASKREL TASK WHERE TASK.CDMAILTASKREL=(SELECT TBL.CDMAILTASKSETTINGS FROM CONOTIFICATION TBL))), 0), CAST(<!%TODAY%> AS DATETIME)))) OR (GNA.DTDEADLINE IS NULL)) THEN 'Em dia' WHEN (( GNA.DTDEADLINE=CAST(<!%TODAY%> AS DATETIME)) OR (GNA.DTDEADLINE > CAST(<!%TODAY%> AS DATETIME))) THEN 'Próximo do vencimento' ELSE 'Em atraso'  END AS NMDEADLINE, ATB.CDTASK FROM PRTASK ATB LEFT JOIN (SELECT REV2.CDTASK, REV2.CDREVISION FROM PRTASKREVISION REV2 WHERE REV2.FGCURRENT=1) ABC ON ABC.CDTASK=ATB.CDTASK LEFT JOIN PRTASKREVISION REV ON (REV.CDREVISION=ABC.CDREVISION AND ATB.CDTASK=REV.CDTASK) LEFT JOIN GNVWAPPROVRESP GNA ON GNA.FGPEND=1 AND (REV.CDAPPROV=GNA.CDAPPROV AND REV.CDPROD=GNA.CDPROD OR ATB.CDPLANPRODROUTE=GNA.CDPROD AND ATB.CDPLANROUTE=GNA.CDAPPROV OR ATB.CDEXECPRODROUTE=GNA.CDPROD AND ATB.CDEXECROUTE=GNA.CDAPPROV OR ATB.CDCLOSINGPRODROUTE=GNA.CDPROD AND ATB.CDCLOSINGROUTE=GNA.CDAPPROV) WHERE (( GNA.DTDEADLINE IN (SELECT MIN(DTDEADLINE) DTDEADLINE FROM GNVWAPPROVRESP WHERE CDPROD=GNA.CDPROD AND CDAPPROV=GNA.CDAPPROV AND FGPEND=1) OR GNA.CDAPPROV IS NULL) AND (GNA.CDCYCLE IN (SELECT MAX(CDCYCLE) FROM GNVWAPPROVRESP WHERE CDPROD=GNA.CDPROD AND CDAPPROV=GNA.CDAPPROV) OR GNA.CDAPPROV IS NULL)) OR (ATB.FGPHASE NOT IN (5,8) OR (ATB.FGPHASE <> 2 AND ATB.FGCLOSING IS NULL AND ATB.FGCLOSING <> 1) OR ATB.FGREVISION NOT IN (2,3)) GROUP BY GNA.DTDEADLINE, ATB.CDTASK) STATUSAPROV WHERE AB.CDTASKTYPE=TB.CDTASKTYPE AND AB.CDTASKDEPT=DP.CDDEPARTMENT AND AB.CDTASKRESP=USA.CDUSER AND ATI.FGTASKTYPE=1 AND ATI.CDTASK=ATV.CDTASK AND ATI.CDTASKDEPT=AR.CDDEPARTMENT AND ATI.CDBASETASK=AB.CDTASK AND (( AB.FGRESTRICT=2 OR AB.FGRESTRICT IS NULL OR AB.FGRESTRICT=0) OR (PRTASKSECURITY.PR_CDTASK IS NOT NULL)) AND ((ATI.CDBASETASK <> ATI.CDTASK) OR (ATI.FGTASKTYPE=3 AND ATI.CDBASETASK=ATI.CDTASK)) AND ATI.CDTASKRESP=US.CDUSER AND AB.CDTASKRESP=15611 AND AB.CDTEAMRESP=4307 AND ((AB.FGPHASE IN (1,5,3)) OR (AB.FGPHASE=2 AND ((AB.DTACTST IS NULL) OR (AB.DTACTST IS NOT NULL AND AB.FGCLOSING IS NULL OR AB.FGCLOSING <> 1))) OR (AB.FGPHASE=2 AND AB.FGCLOSING=1)) AND AB.FGTASKTYPE=1 AND ((ATI.DTPLANST >= '2023-01-01') AND (ATI.DTPLANEND < '2023-06-01')) AND AD1.CDPARAM=9 AND AD2.CDPARAM=73 AND AD1.CDISOSYSTEM=41 AND AD2.CDISOSYSTEM=41 AND ATI.FGTASKTYPE=1 AND ATI.CDTASK=STATUSAPROV.CDTASK
