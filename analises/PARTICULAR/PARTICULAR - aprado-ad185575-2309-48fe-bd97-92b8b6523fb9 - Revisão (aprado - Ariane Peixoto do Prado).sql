SELECT DR.CDREVISION,CAST (CASE WHEN DC.FGSTATUS=1 THEN '#{103645}' WHEN DC.FGSTATUS=2 THEN '#{104235}' WHEN DC.FGSTATUS=3 THEN '#{104705}' WHEN DC.FGSTATUS=4 THEN '#{104230}' WHEN DC.FGSTATUS=5 THEN '#{200421}' WHEN DC.FGSTATUS=6 THEN '#{100263}' WHEN DC.FGSTATUS=7 THEN '#{209484}' END AS VARCHAR(255)) AS FGSTATUSDOC ,CAST (CASE WHEN GR.FGSTATUS=1 THEN '#{103222}' WHEN GR.FGSTATUS=2 THEN '#{104231}' WHEN GR.FGSTATUS=3 THEN '#{100263}' WHEN GR.FGSTATUS=4 THEN '#{104236}' WHEN GR.FGSTATUS=5 THEN '#{104238}' WHEN GR.FGSTATUS=6 THEN '#{101237}' END AS VARCHAR(255)) AS NMSTATUSREV ,CT.IDCATEGORY,DR.IDDOCUMENT,GR.IDREVISION,NRLASTCYCLE,DR.NMAUTHOR,GR.DTREVISION,COALESCE(TRLG.NMTRANSLATION, DR.NMTITLE) AS NMTITLE FROM DCDOCREVISION DR INNER JOIN DCDOCUMENT DC ON DC.CDDOCUMENT=DR.CDDOCUMENT INNER JOIN DCCATEGORY CT ON DR.CDCATEGORY=CT.CDCATEGORY LEFT JOIN GNTRANSLATIONLANGUAGE TRLG ON (DR.CDTRANSLATION=TRLG.CDTRANSLATION AND TRLG.FGLANGUAGE=<!%FGLANGUAGE%>) LEFT JOIN DCDOCUMENTLUCENE DL ON (DC.CDDOCUMENT=DL.CDDOCUMENT AND DL.IDSESSION='8b1cabe4eee94c6cab0c73edd5076dfb') INNER JOIN GNREVISION GR ON GR.CDREVISION=DR.CDREVISION INNER JOIN GNREVCONFIG GNREV ON (GNREV.CDREVCONFIG=CT.CDREVCONFIG) LEFT OUTER JOIN GNREVISIONSTATUS GNST ON (GR.CDREVISIONSTATUS=GNST.CDREVISIONSTATUS) INNER JOIN GNELETRONICFILECFG CFG ON (CFG.CDELETRONICFILECFG=CT.CDELETRONICFILECFG) LEFT OUTER JOIN GNFORMCFGTEMP GFFT ON (GFFT.CDELETRONICFILECFG=CFG.CDELETRONICFILECFG) LEFT OUTER JOIN EFFORM EFF ON (GFFT.OIDFORM=EFF.OID) WHERE 1=1 AND DC.FGSTATUS IN ('1','2','3') AND ((CT.CDCATEGORY IN(27,16,35,40))) AND (1=1 AND (( COALESCE(TRLG.NMTRANSLATION, DR.NMTITLE) LIKE '%0081%') OR (DR.IDDOCUMENT LIKE '%0081%') OR (DR.DSSUMMARY LIKE '%0081%')) OR DL.CDDOCUMENT IS NOT NULL) AND EXISTS (SELECT 1 FROM/*sub*/ GNUSERPERMTYPEROLE PM WHERE PM.CDUSER=<!%CDUSER%> AND CT.CDTYPEROLE=PM.CDTYPEROLE AND PM.CDPERMISSION=5 AND PM.FGPERMISSIONTYPE=1 /* sub */UNION ALL SELECT 1 FROM/*sub*/ GNUSERPERMTYPEROLE PM WHERE PM.CDUSER=-1 AND CT.CDTYPEROLE=PM.CDTYPEROLE AND PM.CDPERMISSION=5 AND PM.FGPERMISSIONTYPE=1 /* sub */UNION ALL SELECT 1 WHERE CT.CDTYPEROLE IS NULL) AND NOT EXISTS (SELECT 1 FROM/*sub*/ GNUSERPERMTYPEROLE PM WHERE PM.CDUSER=<!%CDUSER%> AND CT.CDTYPEROLE=PM.CDTYPEROLE AND PM.CDPERMISSION=5 AND PM.FGPERMISSIONTYPE=2 /* sub */UNION ALL SELECT 1 FROM/*sub*/ GNUSERPERMTYPEROLE PM WHERE PM.CDUSER=-1 AND CT.CDTYPEROLE=PM.CDTYPEROLE AND PM.CDPERMISSION=5 AND PM.FGPERMISSIONTYPE=2) AND EXISTS (SELECT 1 FROM (SELECT DDOC.CDPERMISSION FROM DCUSERPERMISSIONDOC DDOC WHERE DDOC.CDUSER IN (<!%CDUSER%>, -1) AND DDOC.CDPERMISSION IN (3) AND DDOC.CDDOCUMENT=DC.CDDOCUMENT AND DDOC.FGPERMISSIONTYPE=1 /* sub */UNION ALL SELECT PC.CDPERMISSION FROM DCUSERPERMISSIONCATEG PC WHERE PC.CDUSER IN (<!%CDUSER%>, -1) AND PC.CDPERMISSION IN (3) AND DR.CDDOCUMENT=DC.CDDOCUMENT AND PC.FGPERMISSIONTYPE=1 AND DR.CDCATEGORY=PC.CDCATEGORY AND DC.FGUSECATACCESSROLE=1 /* sub */UNION ALL SELECT SRU.CDPERMISSION FROM DCSECRULECONDDOC SRC INNER JOIN DCSECRULECONDUSER SRU ON SRU.CDCONDITION=SRC.CDCONDITION WHERE Dc.FGUSECATACCESSROLE=1 AND SRU.CDUSER IN (<!%CDUSER%>, -1) AND SRU.CDPERMISSION IN (3) AND SRC.CDDOCUMENT=DC.CDDOCUMENT AND SRU.FGPERMISSIONTYPE=1 GROUP BY SRU.CDPERMISSION, SRC.CDDOCUMENT, SRU.CDUSER, SRU.FGPERMISSIONTYPE /* sub */UNION ALL SELECT 1 WHERE DC.CDCREATEDBY=<!%CDUSER%>) PERM WHERE NOT EXISTS(SELECT 1 FROM DCUSERPERMISSIONDOC DDOC WHERE DDOC.CDUSER IN (<!%CDUSER%>, -1) AND DDOC.CDPERMISSION=PERM.CDPERMISSION AND DDOC.CDDOCUMENT=DC.CDDOCUMENT AND DDOC.FGPERMISSIONTYPE=2 AND DC.CDCREATEDBY <> <!%CDUSER%> /* sub */UNION ALL SELECT 1 FROM DCUSERPERMISSIONCATEG PC WHERE PC.CDUSER IN (<!%CDUSER%>, -1) AND PC.CDPERMISSION=PERM.CDPERMISSION AND DR.CDDOCUMENT=DC.CDDOCUMENT AND PC.FGPERMISSIONTYPE=2 AND DR.CDCATEGORY=PC.CDCATEGORY AND DC.FGUSECATACCESSROLE=1 AND DC.CDCREATEDBY <> <!%CDUSER%> /* sub */UNION ALL SELECT 1 FROM DCSECRULECONDDOC SRC INNER JOIN DCSECRULECONDUSER SRU ON SRU.CDCONDITION=SRC.CDCONDITION WHERE DC.FGUSECATACCESSROLE=1 AND SRU.CDUSER IN (<!%CDUSER%>, -1) AND SRU.CDPERMISSION=PERM.CDPERMISSION AND SRC.CDDOCUMENT=DC.CDDOCUMENT AND SRU.FGPERMISSIONTYPE=2 AND DC.CDCREATEDBY <> <!%CDUSER%> GROUP BY SRU.CDPERMISSION, SRC.CDDOCUMENT, SRU.CDUSER, SRU.FGPERMISSIONTYPE) /* sub */UNION ALL SELECT 1 WHERE DC.CDCREATEDBY=<!%CDUSER%>) AND CT.FGENABLEREVISION=1
