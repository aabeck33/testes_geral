SELECT TBSOFTWARE_TEMP.*, ASINVPC.CDASSET, ASINVPC.CDREVISION, ASINVPC.NMNAME AS NMNAMECOMPUTER, ASINVPC.NMDOMAIN, ASINVPC.NMUSERNAME, ASINVCPU.NMTYPE, ASINVPC.NMOS, ASINV.DTIMPORT, ASINVPC.NMPRODUCTKEY, (SELECT SUM(VLCAPACITYMB) FROM ASASTINVCPMEMORY WHERE CDASTINVITCOMPUTER=ASINVPC.CDASTINVITCOMPUTER) AS FULLMEMORY, ASINVPC.NMIPADDRESS, 1 AS QTREGCOUNTER FROM ASASTINVITCOMPUTER ASINVPC INNER JOIN (SELECT ASINVSOFT.CDASTINVITCOMPUTER, ASINVSOFT.NMEDITOR, ASINVSOFT.NMNAME, ASINVSOFT.NMVERSION, ASINVSOFT.NMFOLDER, ASINVSOFT.NMGUID, ASINVSOFT.NMLANGUAGE, ASINVSOFT.NMARCHITECTURE FROM ASASTINVCPSOFTWARE ASINVSOFT) TBSOFTWARE_TEMP ON (TBSOFTWARE_TEMP.CDASTINVITCOMPUTER=ASINVPC.CDASTINVITCOMPUTER) LEFT JOIN ASASTINVCPCPU ASINVCPU ON (ASINVCPU.CDASTINVITCOMPUTER=ASINVPC.CDASTINVITCOMPUTER) INNER JOIN ASASTINVENTORY ASINV ON (ASINVPC.CDASTINVENTORY=ASINV.CDASTINVENTORY) INNER JOIN OBOBJECT OBOBJ ON (OBOBJ.CDOBJECT=ASINVPC.CDASSET AND OBOBJ.CDREVISION=ASINVPC.CDREVISION) LEFT JOIN ASASSET ASAST ON (ASAST.CDASSET=OBOBJ.CDOBJECT AND ASAST.CDREVISION=OBOBJ.CDREVISION) LEFT JOIN OBOBJECTGROUP OBJGRP ON (OBJGRP.CDOBJECTGROUP=OBOBJ.CDOBJECT) LEFT JOIN OBOBJECTTYPE OBJTYPE ON (OBJTYPE.CDOBJECTTYPE=OBJGRP.CDOBJECTTYPE) WHERE 1=1 AND (ASAST.FGASSTATUS IS NULL OR ASAST.FGASSTATUS <> 4) AND UPPER(TBSOFTWARE_TEMP.NMNAME) LIKE UPPER('%onedrive%') AND (ASAST.FGVIEWACCESS=2 OR (ASAST.FGVIEWACCESS=1 AND ASAST.CDTEAMVIEWACCESS IN (SELECT DISTINCT(CDTEAM) FROM ADTEAMUSER WHERE CDUSER=342))) AND (((OBJTYPE.CDTYPEROLE IS NULL OR EXISTS (SELECT NULL FROM (SELECT CHKUSRPERMTYPEROLE.CDTYPEROLE AS CDTYPEROLE, CHKUSRPERMTYPEROLE.CDUSER FROM (SELECT PM.FGPERMISSIONTYPE, PM.CDUSER, PM.CDTYPEROLE FROM GNUSERPERMTYPEROLE PM WHERE 1=1 AND PM.CDUSER <> -1 AND PM.CDPERMISSION=5 /* Nao retirar este comentario */UNION ALL SELECT PM.FGPERMISSIONTYPE, US.CDUSER AS CDUSER, PM.CDTYPEROLE FROM GNUSERPERMTYPEROLE PM CROSS JOIN ADUSER US WHERE 1=1 AND PM.CDUSER=-1 AND US.FGUSERENABLED=1 AND PM.CDPERMISSION=5) CHKUSRPERMTYPEROLE GROUP BY CHKUSRPERMTYPEROLE.CDTYPEROLE, CHKUSRPERMTYPEROLE.CDUSER HAVING MAX(CHKUSRPERMTYPEROLE.FGPERMISSIONTYPE)=1) CHKPERMTYPEROLE WHERE CHKPERMTYPEROLE.CDTYPEROLE=OBJTYPE.CDTYPEROLE AND (CHKPERMTYPEROLE.CDUSER=342 OR 342=-1))))) AND ASINVPC.CDASTINVITCOMPUTER=(SELECT MAX(CDASTINVITCOMPUTER) FROM ASASTINVITCOMPUTER MAXASTINVITCP INNER JOIN ASASTINVENTORY MAXASTINV ON (MAXASTINVITCP.CDASTINVENTORY=MAXASTINV.CDASTINVENTORY) WHERE MAXASTINVITCP.CDASSET=ASINVPC.CDASSET AND MAXASTINVITCP.CDREVISION=ASINVPC.CDREVISION)
