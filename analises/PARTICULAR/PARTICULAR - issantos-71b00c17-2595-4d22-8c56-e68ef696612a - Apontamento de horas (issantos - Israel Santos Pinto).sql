SELECT TIMESHEETVIEW.DTACTUAL, DATEPART(mm, TIMESHEETVIEW.DTACTUAL) AS MONTHSHEET, DATEPART(ww, TIMESHEETVIEW.DTACTUAL) AS WEEKSHEET, DATEPART(yyyy, TIMESHEETVIEW.DTACTUAL) AS YEARSHEET, TIMESHEETVIEW.CDRESOURCE, TIMESHEETVIEW.IDRESOURCE, TIMESHEETVIEW.NMRESOURCE, TIMESHEETVIEW.CDTIMESHEET, CASE WHEN FGOVER=0 THEN CAST( TIMESHEETVIEW.QTSTRAIGHTMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12)) ELSE CASE WHEN FGOVER=2 THEN CAST( GTE.QTTOTALMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12)) END END AS QTSTRAIGHTMIN, CASE WHEN FGOVER=0 THEN CAST( TIMESHEETVIEW.QTOVERMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12)) ELSE CASE WHEN FGOVER=1 THEN CAST( GTE.QTTOTALMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12)) END END AS QTOVERMIN, (COALESCE (CASE WHEN FGOVER=0 THEN (CAST( TIMESHEETVIEW.QTSTRAIGHTMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12))) ELSE CASE WHEN FGOVER=2 THEN (CAST( GTE.QTTOTALMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12))) END END, 0) + COALESCE(CASE WHEN FGOVER=0 THEN (CAST( TIMESHEETVIEW.QTOVERMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12))) ELSE CASE WHEN FGOVER=1 THEN (CAST( GTE.QTTOTALMIN AS NUMERIC(28,12)) * CAST( 60 * 1000 AS NUMERIC(28,12))) END END, 0)) AS QTTOTALMIN, CASE WHEN TIMESHEETVIEW.CDUSER IS NULL THEN -1 ELSE TIMESHEETVIEW.CDUSER END AS CDUSER, TIMESHEETVIEW.RESOURCEUSER, TIMESHEETVIEW.IDOBJECT + ' - ' + TIMESHEETVIEW.NMOBJECT AS OBJETO, TIMESHEETVIEW.IDACTIVITY + ' - ' + TIMESHEETVIEW.NMACTIVITY AS ATIVIDADE, CASE TIMESHEETVIEW.CHARGE WHEN 1 THEN 'Faturada' ELSE 'NÃ£o faturada' END AS CHARGE, TIMESHEETVIEW.DEPARTMENT, TIMESHEETVIEW.POSITION, TIMESHEETVIEW.IDTYPE, TIMESHEETVIEW.CDISOSYSTEM, TIMESHEETVIEW.TMSTRAIGHTHOURS, TIMESHEETVIEW.TMOVERHOURS, GTE.QTTOTALMIN AS TOTALMINENTRY, GTE.NRSEQTIME, TIMESHEETVIEW.TYPEDATA, TIMESHEETVIEW.FGACTIVITYTYPE, TIMESHEETVIEW.CDACTIVITY, TIMESHEETVIEW.CDOBJECT, GTE.FGMODE, GTE.FGOVER, GTE.TMSTARTHOURS, GTE.TMENDHOURS, GTE.TMTOTALHOURS, GTE.DSDESCRIPTION, GTE.DSNOTES, GTE.DSJUSTIFY, GTS.FGSTATUS, GTS.CDAPPROV, CASE WHEN ADU.NMUSER IS NULL THEN 'Admin' ELSE ADU.NMUSER END AS NMUSER, TIMESHEETVIEW.IDOBJECTPROCESS FROM (SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, ATITYPE.IDTASKTYPE + ' - ' + ATITYPE.NMTASKTYPE AS IDTYPE, ATI.CDTASKTYPE AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, CASE ATI.FGCHARGE WHEN 1 THEN 1 ELSE 2 END AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION, ATI.CDTASK AS CDACTIVITY, ATI.NMIDTASK AS IDACTIVITY, ATB.CDTASK AS CDOBJECT, ATB.NMIDTASK AS IDOBJECT, ATB.NMTASK AS NMOBJECT, ATI.FGTASKTYPE AS FGACTIVITYTYPE, ATI.NMTASK AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN PRTASKTIMESHEET TASKTIME ON (TASKTIME.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN PRTASK ATI ON (ATI.CDTASK=TASKTIME.CDTASK) LEFT OUTER JOIN PRTASKTYPE ATITYPE ON (ATI.CDTASKTYPE=ATITYPE.CDTASKTYPE) INNER JOIN PRTASK ATB ON (ATI.CDBASETASK=ATB.CDTASK) LEFT JOIN (SELECT DISTINCT PVIEW.PR_CDTASK FROM (SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDDEPARTMENT=ACCVIEW.CDDEPARTMENT  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=1 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDPOSITION=ACCVIEW.CDPOSITION  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=2 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDDEPARTMENT=ACCVIEW.CDDEPARTMENT AND UDP.CDPOSITION=ACCVIEW.CDPOSITION  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=3 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, ACCVIEW.CDUSER FROM PRTASKACCESS ACCVIEW  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=4 AND ACCVIEW.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, TMM.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADTEAMUSER TMM ON TMM.CDTEAM=ACCVIEW.CDTEAM  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=5 AND TMM.CDUSER=15611) PVIEW WHERE 1=1) PRTASKSECURITY ON PRTASKSECURITY.PR_CDTASK=ATB.CDBASETASK AND ATB.FGRESTRICT=1 INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (GNR.CDUSER=ADDP.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' AND ATI.FGTASKTYPE=1 AND (( ATB.FGRESTRICT=2 OR ATB.FGRESTRICT IS NULL OR ATB.FGRESTRICT=0) OR (PRTASKSECURITY.PR_CDTASK IS NOT NULL)) UNION ALL SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, NULL AS IDTYPE, 0 AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, 2 AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION,  GNA.CDGENACTIVITY AS CDACTIVITY, GNA.IDACTIVITY AS IDACTIVITY, ASEXECACT.CDEXECACTIVITY AS CDOBJECT, GNA.IDACTIVITY AS IDOBJECT, CASE WHEN ASEXECACT.CDPLANNING IS NULL THEN ASACT.IDACTIVITY + ' - ' + ASACT.NMACTIVITY ELSE ASPLANACT.IDPLANACTIVITY + ' - ' + ASPLANACT.NMPLANACTIVITY END AS NMOBJECT, CAST(8 AS NUMERIC(10)) AS FGACTIVITYTYPE, GNA.IDACTIVITY AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN GNACTIVITYTSHEET GNTS ON (GNTS.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (ADDP.CDUSER=GNR.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) INNER JOIN GNACTIVITY GNA ON (GNA.CDGENACTIVITY=GNTS.CDGENACTIVITY)  INNER JOIN GNACTIVITYTIMECFG GNCFG ON (GNA.CDACTIVITYTIMECFG=GNCFG.CDACTIVITYTIMECFG) INNER JOIN ASEXECACTIVITY ASEXECACT ON (GNA.CDGENACTIVITY=ASEXECACT.CDGENACTIVITY) LEFT JOIN ASPLANACTIVITY ASPLANACT ON (ASPLANACT.CDPLANACTIVITY=ASEXECACT.CDPLANNING) INNER JOIN ASACTIVITY ASACT ON (ASEXECACT.CDACTIVITY=ASACT.CDACTIVITY) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' AND ASEXECACT.FGACTTYPE IN (1) UNION ALL SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, NULL AS IDTYPE, 0 AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, 2 AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION,  GNA.CDGENACTIVITY AS CDACTIVITY, GNA.IDACTIVITY AS IDACTIVITY, ASEXECACT.CDEXECACTIVITY AS CDOBJECT, GNA.IDACTIVITY AS IDOBJECT, CASE WHEN ASEXECACT.CDPLANNING IS NULL THEN ASACT.IDACTIVITY + ' - ' + ASACT.NMACTIVITY ELSE ASPLANACT.IDPLANACTIVITY + ' - ' + ASPLANACT.NMPLANACTIVITY END AS NMOBJECT, CAST(9 AS NUMERIC(10)) AS FGACTIVITYTYPE, GNA.IDACTIVITY AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN GNACTIVITYTSHEET GNTS ON (GNTS.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (ADDP.CDUSER=GNR.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) INNER JOIN GNACTIVITY GNA ON (GNA.CDGENACTIVITY=GNTS.CDGENACTIVITY)  INNER JOIN GNACTIVITYTIMECFG GNCFG ON (GNA.CDACTIVITYTIMECFG=GNCFG.CDACTIVITYTIMECFG) INNER JOIN ASEXECACTIVITY ASEXECACT ON (GNA.CDGENACTIVITY=ASEXECACT.CDGENACTIVITY) LEFT JOIN ASPLANACTIVITY ASPLANACT ON (ASPLANACT.CDPLANACTIVITY=ASEXECACT.CDPLANNING) INNER JOIN ASACTIVITY ASACT ON (ASEXECACT.CDACTIVITY=ASACT.CDACTIVITY) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' AND ASEXECACT.FGACTTYPE IN (3) UNION ALL SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, NULL AS IDTYPE, 0 AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, 2 AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION,  GNA.CDGENACTIVITY AS CDACTIVITY, GNA.IDACTIVITY AS IDACTIVITY, ASEXECACT.CDEXECACTIVITY AS CDOBJECT, GNA.IDACTIVITY AS IDOBJECT, CASE WHEN ASEXECACT.CDPLANNING IS NULL THEN ASACT.IDACTIVITY + ' - ' + ASACT.NMACTIVITY ELSE ASPLANACT.IDPLANACTIVITY + ' - ' + ASPLANACT.NMPLANACTIVITY END AS NMOBJECT, CAST(10 AS NUMERIC(10)) AS FGACTIVITYTYPE, GNA.IDACTIVITY AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN GNACTIVITYTSHEET GNTS ON (GNTS.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (ADDP.CDUSER=GNR.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) INNER JOIN GNACTIVITY GNA ON (GNA.CDGENACTIVITY=GNTS.CDGENACTIVITY)  INNER JOIN GNACTIVITYTIMECFG GNCFG ON (GNA.CDACTIVITYTIMECFG=GNCFG.CDACTIVITYTIMECFG) INNER JOIN ASEXECACTIVITY ASEXECACT ON (GNA.CDGENACTIVITY=ASEXECACT.CDGENACTIVITY) LEFT JOIN ASPLANACTIVITY ASPLANACT ON (ASPLANACT.CDPLANACTIVITY=ASEXECACT.CDPLANNING) INNER JOIN ASACTIVITY ASACT ON (ASEXECACT.CDACTIVITY=ASACT.CDACTIVITY) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' AND ASEXECACT.FGACTTYPE IN (2,6,7,8) UNION ALL SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, NULL AS IDTYPE, 0 AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, 2 AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION, GNA.CDGENACTIVITY AS CDACTIVITY, GNA.IDACTIVITY, CASE WHEN GNACT2.CDGENACTIVITY IS NULL THEN GNA.CDGENACTIVITY ELSE GNACT2.CDGENACTIVITY END AS CDOBJECT, CASE WHEN GNACT2.IDACTIVITY IS NULL THEN GNA.IDACTIVITY ELSE GNACT2.IDACTIVITY END AS IDOBJECT, CASE WHEN GNACT2.NMACTIVITY IS NULL THEN GNA.NMACTIVITY ELSE GNACT2.NMACTIVITY END AS NMOBJECT, CASE WHEN GNA.CDACTIVITYOWNER IS NULL THEN 6 ELSE 7 END AS FGACTIVITYTYPE,GNA.NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN GNACTIVITYTSHEET GNTS ON (GNTS.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (ADDP.CDUSER=GNR.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) INNER JOIN GNACTIVITY GNA ON (GNA.CDGENACTIVITY=GNTS.CDGENACTIVITY) INNER JOIN GNTASK GNTK ON (GNA.CDGENACTIVITY=GNTK.CDGENACTIVITY) LEFT OUTER JOIN GNGENTYPE GNGNTP ON (GNGNTP.CDGENTYPE=GNTK.CDTASKTYPE) LEFT OUTER JOIN GNACTIVITY GNACT2 ON (GNACT2.CDGENACTIVITY=GNA.CDACTIVITYOWNER) LEFT OUTER JOIN GNACTIONPLAN GNACTPL ON (GNACTPL.CDGENACTIVITY=GNACT2.CDGENACTIVITY) LEFT OUTER JOIN GNGENTYPE GNGNTP2 ON (GNGNTP2.CDGENTYPE=GNACTPL.CDACTIONPLANTYPE) INNER JOIN ADUSER ADUS ON (GNA.CDUSER=ADUS.CDUSER) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' UNION ALL SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, GNGT.IDGENTYPE + ' - ' + GNGT.NMGENTYPE AS IDTYPE, GNM.CDMEETINGTYPE AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, 2 AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION, GNM.CDMEETING AS CDACTIVITY, GNM.IDMEETING AS IDACTIVITY, GNM.CDMEETING AS CDOBJECT, GNM.IDMEETING AS IDOBJECT, GNM.NMMEETING AS NMOBJECT, 4 AS FGACTIVITYTYPE, GNM.NMMEETING AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN GNMEETINGTSHEET GMTS ON (GMTS.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN GNMEETING GNM ON (GNM.CDMEETING=GMTS.CDMEETING) LEFT OUTER JOIN GNGENTYPE GNGT ON (GNM.CDMEETINGTYPE=GNGT.CDGENTYPE) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (ADDP.CDUSER=GNR.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' UNION ALL SELECT GNTS.CDISOSYSTEM, GNTS.CDTIMESHEET, GNR.IDRESOURCE, GNR.NMRESOURCE, GNR.CDRESOURCE, '' AS IDTYPE, -1 AS TYPEDATA, 0 AS PLANEJADO, GNTS.DTACTUAL, GNTS.CDUSER, GNR.CDUSER AS RESOURCEUSER, GNTS.FGSTATUS, GNTS.QTSTRAIGHTMIN, GNTS.QTOVERMIN, GNTS.TMSTRAIGHTHOURS, GNTS.TMOVERHOURS, GNTS.QTTOTALMIN, 2 AS CHARGE, ADDP.IDDEPARTMENT + ' - ' + ADDP.NMDEPARTMENT AS DEPARTMENT, ADP.IDPOSITION + ' - ' + ADP.NMPOSITION AS POSITION, ADUDP.CDDEPARTMENT, ADUDP.CDPOSITION, GNA.CDGENACTIVITY AS CDACTIVITY, WFS.IDSTRUCT AS IDACTIVITY, GNAWF.CDGENACTIVITY AS CDOBJECT, WFP.IDPROCESS AS IDOBJECT, WFP.NMPROCESS AS NMOBJECT, 11 AS FGACTIVITYTYPE, WFS.NMSTRUCT AS NMACTIVITY, WFP.IDOBJECT AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNACTIVITY GNA INNER JOIN WFACTIVITY WFA ON (WFA.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN WFSTRUCT WFS ON (WFS.IDOBJECT=WFA.IDOBJECT) INNER JOIN WFPROCESS WFP ON (WFP.IDOBJECT=WFS.IDPROCESS) INNER JOIN GNACTIVITY GNAWF ON (GNAWF.CDGENACTIVITY=WFP.CDGENACTIVITY) INNER JOIN GNACTIVITYTSHEET GNATS ON (GNATS.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN GNTIMESHEET GNTS ON (GNTS.CDTIMESHEET=GNATS.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=GNTS.CDRESOURCE) LEFT JOIN ADUSERDEPTPOS ADUDP ON (ADUDP.CDUSER=GNR.CDUSER AND ADUDP.FGDEFAULTDEPTPOS=1) LEFT JOIN ADDEPARTMENT ADDP ON (ADDP.CDDEPARTMENT=ADUDP.CDDEPARTMENT) LEFT JOIN ADPOSITION ADP ON (ADP.CDPOSITION=ADUDP.CDPOSITION) INNER JOIN (SELECT DISTINCT Z.IDOBJECT FROM (SELECT AUXWFP.IDOBJECT FROM WFPROCESS AUXWFP INNER JOIN (SELECT PERM.USERCD, PERM.IDPROCESS, MIN(PERM.FGPERMISSION) AS FGPERMISSION FROM (SELECT WF.FGPERMISSION, WF.IDPROCESS, TM.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADTEAMUSER TM ON WF.CDTEAM=TM.CDTEAM WHERE WF.FGACCESSTYPE=1 AND TM.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE WF.FGACCESSTYPE=2 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDDEPARTMENT=UDP.CDDEPARTMENT AND WF.CDPOSITION=UDP.CDPOSITION WHERE WF.FGACCESSTYPE=3 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDPOSITION=UDP.CDPOSITION WHERE WF.FGACCESSTYPE=4 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, WF.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF WHERE WF.FGACCESSTYPE=5 AND WF.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, US.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF CROSS JOIN ADUSER US WHERE WF.FGACCESSTYPE=6 AND US.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, RL.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERROLE RL ON RL.CDROLE=WF.CDROLE WHERE WF.FGACCESSTYPE=7 AND RL.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, WFP.CDUSERSTART AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN WFPROCESS WFP ON WFP.IDOBJECT=WF.IDPROCESS WHERE WF.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, US.CDLEADER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN WFPROCESS WFP ON WFP.IDOBJECT=WF.IDPROCESS INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE WF.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WF.FGACCESSEXCEPTION IS NULL) PERM INNER JOIN WFPROCSECURITYCTRL GNASSOC ON (GNASSOC.CDACCESSLIST=PERM.CDACCESSLIST AND GNASSOC.IDPROCESS=PERM.IDPROCESS) WHERE GNASSOC.CDACCESSROLEFIELD IN (501) GROUP BY PERM.USERCD, PERM.IDPROCESS) PERMISSION ON PERMISSION.IDPROCESS=AUXWFP.IDOBJECT WHERE PERMISSION.FGPERMISSION=1 AND AUXWFP.FGSTATUS <= 5 AND (AUXWFP.FGMODELWFSECURITY IS NULL OR AUXWFP.FGMODELWFSECURITY=0) UNION ALL SELECT T.IDOBJECT FROM (SELECT MIN(PERM99.FGPERMISSION) AS FGPERMISSION, PERM99.IDOBJECT FROM (SELECT WFP.IDOBJECT, PERM1.FGPERMISSION FROM (SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, TM.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADTEAMUSER TM ON PP.CDTEAM=TM.CDTEAM WHERE PP.FGACCESSTYPE=1 AND TM.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON PP.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE PP.FGACCESSTYPE=2 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON (PP.CDDEPARTMENT=UDP.CDDEPARTMENT AND PP.CDPOSITION=UDP.CDPOSITION) WHERE PP.FGACCESSTYPE=3 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON PP.CDPOSITION=UDP.CDPOSITION WHERE PP.FGACCESSTYPE=4 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, PP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP WHERE PP.FGACCESSTYPE=5 AND PP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, US.CDUSER AS USERCD FROM PMPROCACCESSLIST PP CROSS JOIN ADUSER US WHERE PP.FGACCESSTYPE=6 AND US.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, RL.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERROLE RL ON RL.CDROLE=PP.CDROLE WHERE PP.FGACCESSTYPE=7 AND RL.CDUSER=15611) PERM1 INNER JOIN PMPROCSECURITYCTRL GNASSOC ON (PERM1.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM1.CDPROC=GNASSOC.CDPROC) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACTIVITY OBJ ON GNASSOC.CDPROC=OBJ.CDACTIVITY INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PERM1.CDPROC WHERE GNCTRL.CDRELATEDFIELD IN (501) AND (OBJ.FGUSETYPEACCESS=0 OR OBJ.FGUSETYPEACCESS IS NULL) AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5 UNION ALL SELECT PERM2.IDOBJECT, PERM2.FGPERMISSION FROM (SELECT PP.FGPERMISSION, WFP.IDOBJECT, PP.CDPROC, PP.CDACCESSLIST, WFP.CDUSERSTART AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PP.CDPROC WHERE PP.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5 UNION ALL SELECT PP.FGPERMISSION, WFP.IDOBJECT, PP.CDPROC, PP.CDACCESSLIST, US.CDLEADER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PP.CDPROC INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE PP.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5) PERM2 INNER JOIN PMPROCSECURITYCTRL GNASSOC ON (PERM2.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM2.CDPROC=GNASSOC.CDPROC) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACTIVITY OBJ ON GNASSOC.CDPROC=OBJ.CDACTIVITY WHERE GNCTRL.CDRELATEDFIELD IN (501) AND (OBJ.FGUSETYPEACCESS=0 OR OBJ.FGUSETYPEACCESS IS NULL)) PERM99 WHERE 1=1 GROUP BY PERM99.IDOBJECT) T WHERE T.FGPERMISSION=1 UNION ALL SELECT PERM.IDOBJECT FROM (SELECT WFP.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADTEAMUSER TM ON PM.CDTEAM=TM.CDTEAM WHERE PM.FGACCESSTYPE=1 AND TM.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE PM.FGACCESSTYPE=2 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDDEPARTMENT=UDP.CDDEPARTMENT AND PM.CDPOSITION=UDP.CDPOSITION WHERE PM.FGACCESSTYPE=3 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDPOSITION=UDP.CDPOSITION WHERE PM.FGACCESSTYPE=4 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM WHERE PM.FGACCESSTYPE=5 AND PM.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM WHERE PM.FGACCESSTYPE=6 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERROLE RL ON RL.CDROLE=PM.CDROLE WHERE PM.FGACCESSTYPE=7 AND RL.CDUSER=15611) PERM1 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM1.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM1.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM1.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND WFP.FGSTATUS <= 5 AND PMA.FGUSETYPEACCESS=1 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT WFP.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE WHERE PM.FGACCESSTYPE=8 AND PMA.CDCREATEDBY=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON DEP2.CDDEPARTMENT=DEP1.CDDEPARTMENT WHERE PM.FGACCESSTYPE=9 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON (DEP2.CDDEPARTMENT=DEP1.CDDEPARTMENT AND DEP2.CDPOSITION=DEP1.CDPOSITION) WHERE PM.FGACCESSTYPE=10 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON DEP2.CDPOSITION=DEP1.CDPOSITION WHERE PM.FGACCESSTYPE=11 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSER US ON US.CDUSER=PMA.CDCREATEDBY WHERE PM.FGACCESSTYPE=12 AND US.CDLEADER=15611) PERM2 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM2.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM2.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM2.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND WFP.FGSTATUS <= 5 AND PMA.FGUSETYPEACCESS=1 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT PERM3.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST, WFP.IDOBJECT FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE PM.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WFP.FGSTATUS <= 5 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST, WFP.IDOBJECT FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE PM.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WFP.FGSTATUS <= 5 AND WFP.FGMODELWFSECURITY=1) PERM3 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM3.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM3.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM3.CDACTTYPE=PMA.CDACTTYPE WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND PMA.FGUSETYPEACCESS=1) PERM UNION ALL SELECT AUXWFP.IDOBJECT FROM WFPROCESS AUXWFP INNER JOIN WFPROCSECURITYLIST WFLIST ON (AUXWFP.IDOBJECT=WFLIST.IDPROCESS) INNER JOIN WFPROCSECURITYCTRL WFCTRL ON (WFLIST.CDACCESSLIST=WFCTRL.CDACCESSLIST AND WFLIST.IDPROCESS=WFCTRL.IDPROCESS) WHERE WFCTRL.CDACCESSROLEFIELD IN (501) AND WFLIST.CDUSER=15611 AND WFLIST.FGACCESSTYPE=5 AND WFLIST.FGACCESSEXCEPTION=1 AND WFLIST.FGPERMISSION=1 AND AUXWFP.FGSTATUS <= 5) Z) MYPERM ON (WFP.IDOBJECT=MYPERM.IDOBJECT) WHERE (WFP.CDPRODAUTOMATION IS NULL OR WFP.CDPRODAUTOMATION NOT IN (160, 202, 275)) AND GNTS.DTACTUAL >= '2022-07-25' AND GNTS.DTACTUAL <= '2022-07-31'  UNION ALL SELECT GNTS.CDISOSYSTEM, GNTS.CDTIMESHEET, GNR.IDRESOURCE, GNR.NMRESOURCE, GNR.CDRESOURCE, '' AS IDTYPE, -1 AS TYPEDATA, 0 AS PLANEJADO, GNTS.DTACTUAL, GNTS.CDUSER, GNR.CDUSER AS RESOURCEUSER, GNTS.FGSTATUS, GNTS.QTSTRAIGHTMIN, GNTS.QTOVERMIN, GNTS.TMSTRAIGHTHOURS, GNTS.TMOVERHOURS, GNTS.QTTOTALMIN, 2 AS CHARGE, ADDP.IDDEPARTMENT + ' - ' + ADDP.NMDEPARTMENT AS DEPARTMENT, ADP.IDPOSITION + ' - ' + ADP.NMPOSITION AS POSITION, ADUDP.CDDEPARTMENT, ADUDP.CDPOSITION, GNA.CDGENACTIVITY AS CDACTIVITY, WFS.IDSTRUCT AS IDACTIVITY, GNAWF.CDGENACTIVITY AS CDOBJECT, WFP.IDPROCESS AS IDOBJECT, WFP.NMPROCESS AS NMOBJECT, 12 AS FGACTIVITYTYPE, WFS.NMSTRUCT AS NMACTIVITY, WFP.IDOBJECT AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNACTIVITY GNA INNER JOIN WFACTIVITY WFA ON (WFA.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN WFSTRUCT WFS ON (WFS.IDOBJECT=WFA.IDOBJECT) INNER JOIN WFPROCESS WFP ON (WFP.IDOBJECT=WFS.IDPROCESS) INNER JOIN GNACTIVITY GNAWF ON (GNAWF.CDGENACTIVITY=WFP.CDGENACTIVITY) INNER JOIN GNACTIVITYTSHEET GNATS ON (GNATS.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN GNTIMESHEET GNTS ON (GNTS.CDTIMESHEET=GNATS.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=GNTS.CDRESOURCE) LEFT JOIN ADUSERDEPTPOS ADUDP ON (ADUDP.CDUSER=GNR.CDUSER AND ADUDP.FGDEFAULTDEPTPOS=1) LEFT JOIN ADDEPARTMENT ADDP ON (ADDP.CDDEPARTMENT=ADUDP.CDDEPARTMENT) LEFT JOIN ADPOSITION ADP ON (ADP.CDPOSITION=ADUDP.CDPOSITION) INNER JOIN (SELECT DISTINCT Z.IDOBJECT FROM (SELECT AUXWFP.IDOBJECT FROM WFPROCESS AUXWFP INNER JOIN (SELECT PERM.USERCD, PERM.IDPROCESS, MIN(PERM.FGPERMISSION) AS FGPERMISSION FROM (SELECT WF.FGPERMISSION, WF.IDPROCESS, TM.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADTEAMUSER TM ON WF.CDTEAM=TM.CDTEAM WHERE WF.FGACCESSTYPE=1 AND TM.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE WF.FGACCESSTYPE=2 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDDEPARTMENT=UDP.CDDEPARTMENT AND WF.CDPOSITION=UDP.CDPOSITION WHERE WF.FGACCESSTYPE=3 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDPOSITION=UDP.CDPOSITION WHERE WF.FGACCESSTYPE=4 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, WF.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF WHERE WF.FGACCESSTYPE=5 AND WF.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, US.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF CROSS JOIN ADUSER US WHERE WF.FGACCESSTYPE=6 AND US.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, RL.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERROLE RL ON RL.CDROLE=WF.CDROLE WHERE WF.FGACCESSTYPE=7 AND RL.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, WFP.CDUSERSTART AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN WFPROCESS WFP ON WFP.IDOBJECT=WF.IDPROCESS WHERE WF.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, US.CDLEADER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN WFPROCESS WFP ON WFP.IDOBJECT=WF.IDPROCESS INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE WF.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WF.FGACCESSEXCEPTION IS NULL) PERM INNER JOIN WFPROCSECURITYCTRL GNASSOC ON (GNASSOC.CDACCESSLIST=PERM.CDACCESSLIST AND GNASSOC.IDPROCESS=PERM.IDPROCESS) WHERE GNASSOC.CDACCESSROLEFIELD IN (501) GROUP BY PERM.USERCD, PERM.IDPROCESS) PERMISSION ON PERMISSION.IDPROCESS=AUXWFP.IDOBJECT WHERE PERMISSION.FGPERMISSION=1 AND AUXWFP.FGSTATUS <= 5 AND (AUXWFP.FGMODELWFSECURITY IS NULL OR AUXWFP.FGMODELWFSECURITY=0) UNION ALL SELECT T.IDOBJECT FROM (SELECT MIN(PERM99.FGPERMISSION) AS FGPERMISSION, PERM99.IDOBJECT FROM (SELECT WFP.IDOBJECT, PERM1.FGPERMISSION FROM (SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, TM.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADTEAMUSER TM ON PP.CDTEAM=TM.CDTEAM WHERE PP.FGACCESSTYPE=1 AND TM.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON PP.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE PP.FGACCESSTYPE=2 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON (PP.CDDEPARTMENT=UDP.CDDEPARTMENT AND PP.CDPOSITION=UDP.CDPOSITION) WHERE PP.FGACCESSTYPE=3 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON PP.CDPOSITION=UDP.CDPOSITION WHERE PP.FGACCESSTYPE=4 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, PP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP WHERE PP.FGACCESSTYPE=5 AND PP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, US.CDUSER AS USERCD FROM PMPROCACCESSLIST PP CROSS JOIN ADUSER US WHERE PP.FGACCESSTYPE=6 AND US.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, RL.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERROLE RL ON RL.CDROLE=PP.CDROLE WHERE PP.FGACCESSTYPE=7 AND RL.CDUSER=15611) PERM1 INNER JOIN PMPROCSECURITYCTRL GNASSOC ON (PERM1.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM1.CDPROC=GNASSOC.CDPROC) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACTIVITY OBJ ON GNASSOC.CDPROC=OBJ.CDACTIVITY INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PERM1.CDPROC WHERE GNCTRL.CDRELATEDFIELD IN (501) AND (OBJ.FGUSETYPEACCESS=0 OR OBJ.FGUSETYPEACCESS IS NULL) AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5 UNION ALL SELECT PERM2.IDOBJECT, PERM2.FGPERMISSION FROM (SELECT PP.FGPERMISSION, WFP.IDOBJECT, PP.CDPROC, PP.CDACCESSLIST, WFP.CDUSERSTART AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PP.CDPROC WHERE PP.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5 UNION ALL SELECT PP.FGPERMISSION, WFP.IDOBJECT, PP.CDPROC, PP.CDACCESSLIST, US.CDLEADER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PP.CDPROC INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE PP.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5) PERM2 INNER JOIN PMPROCSECURITYCTRL GNASSOC ON (PERM2.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM2.CDPROC=GNASSOC.CDPROC) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACTIVITY OBJ ON GNASSOC.CDPROC=OBJ.CDACTIVITY WHERE GNCTRL.CDRELATEDFIELD IN (501) AND (OBJ.FGUSETYPEACCESS=0 OR OBJ.FGUSETYPEACCESS IS NULL)) PERM99 WHERE 1=1 GROUP BY PERM99.IDOBJECT) T WHERE T.FGPERMISSION=1 UNION ALL SELECT PERM.IDOBJECT FROM (SELECT WFP.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADTEAMUSER TM ON PM.CDTEAM=TM.CDTEAM WHERE PM.FGACCESSTYPE=1 AND TM.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE PM.FGACCESSTYPE=2 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDDEPARTMENT=UDP.CDDEPARTMENT AND PM.CDPOSITION=UDP.CDPOSITION WHERE PM.FGACCESSTYPE=3 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDPOSITION=UDP.CDPOSITION WHERE PM.FGACCESSTYPE=4 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM WHERE PM.FGACCESSTYPE=5 AND PM.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM WHERE PM.FGACCESSTYPE=6 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERROLE RL ON RL.CDROLE=PM.CDROLE WHERE PM.FGACCESSTYPE=7 AND RL.CDUSER=15611) PERM1 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM1.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM1.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM1.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND WFP.FGSTATUS <= 5 AND PMA.FGUSETYPEACCESS=1 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT WFP.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE WHERE PM.FGACCESSTYPE=8 AND PMA.CDCREATEDBY=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON DEP2.CDDEPARTMENT=DEP1.CDDEPARTMENT WHERE PM.FGACCESSTYPE=9 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON (DEP2.CDDEPARTMENT=DEP1.CDDEPARTMENT AND DEP2.CDPOSITION=DEP1.CDPOSITION) WHERE PM.FGACCESSTYPE=10 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON DEP2.CDPOSITION=DEP1.CDPOSITION WHERE PM.FGACCESSTYPE=11 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSER US ON US.CDUSER=PMA.CDCREATEDBY WHERE PM.FGACCESSTYPE=12 AND US.CDLEADER=15611) PERM2 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM2.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM2.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM2.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND WFP.FGSTATUS <= 5 AND PMA.FGUSETYPEACCESS=1 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT PERM3.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST, WFP.IDOBJECT FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE PM.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WFP.FGSTATUS <= 5 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST, WFP.IDOBJECT FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE PM.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WFP.FGSTATUS <= 5 AND WFP.FGMODELWFSECURITY=1) PERM3 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM3.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM3.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM3.CDACTTYPE=PMA.CDACTTYPE WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND PMA.FGUSETYPEACCESS=1) PERM UNION ALL SELECT AUXWFP.IDOBJECT FROM WFPROCESS AUXWFP INNER JOIN WFPROCSECURITYLIST WFLIST ON (AUXWFP.IDOBJECT=WFLIST.IDPROCESS) INNER JOIN WFPROCSECURITYCTRL WFCTRL ON (WFLIST.CDACCESSLIST=WFCTRL.CDACCESSLIST AND WFLIST.IDPROCESS=WFCTRL.IDPROCESS) WHERE WFCTRL.CDACCESSROLEFIELD IN (501) AND WFLIST.CDUSER=15611 AND WFLIST.FGACCESSTYPE=5 AND WFLIST.FGACCESSEXCEPTION=1 AND WFLIST.FGPERMISSION=1 AND AUXWFP.FGSTATUS <= 5) Z) MYPERM ON (WFP.IDOBJECT=MYPERM.IDOBJECT) WHERE WFP.CDPRODAUTOMATION=160 AND GNTS.DTACTUAL >= '2022-07-25' AND GNTS.DTACTUAL <= '2022-07-31'  UNION ALL SELECT GNTS.CDISOSYSTEM, GNTS.CDTIMESHEET, GNR.IDRESOURCE, GNR.NMRESOURCE, GNR.CDRESOURCE, '' AS IDTYPE, -1 AS TYPEDATA, 0 AS PLANEJADO, GNTS.DTACTUAL, GNTS.CDUSER, GNR.CDUSER AS RESOURCEUSER, GNTS.FGSTATUS, GNTS.QTSTRAIGHTMIN, GNTS.QTOVERMIN, GNTS.TMSTRAIGHTHOURS, GNTS.TMOVERHOURS, GNTS.QTTOTALMIN, 2 AS CHARGE, ADDP.IDDEPARTMENT + ' - ' + ADDP.NMDEPARTMENT AS DEPARTMENT, ADP.IDPOSITION + ' - ' + ADP.NMPOSITION AS POSITION, ADUDP.CDDEPARTMENT, ADUDP.CDPOSITION, GNA.CDGENACTIVITY AS CDACTIVITY, WFS.IDSTRUCT AS IDACTIVITY, GNAWF.CDGENACTIVITY AS CDOBJECT, WFP.IDPROCESS AS IDOBJECT, WFP.NMPROCESS AS NMOBJECT, 13 AS FGACTIVITYTYPE, WFS.NMSTRUCT AS NMACTIVITY, WFP.IDOBJECT AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNACTIVITY GNA INNER JOIN WFACTIVITY WFA ON (WFA.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN WFSTRUCT WFS ON (WFS.IDOBJECT=WFA.IDOBJECT) INNER JOIN WFPROCESS WFP ON (WFP.IDOBJECT=WFS.IDPROCESS) INNER JOIN GNACTIVITY GNAWF ON (GNAWF.CDGENACTIVITY=WFP.CDGENACTIVITY) INNER JOIN GNACTIVITYTSHEET GNATS ON (GNATS.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN GNTIMESHEET GNTS ON (GNTS.CDTIMESHEET=GNATS.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=GNTS.CDRESOURCE) LEFT JOIN ADUSERDEPTPOS ADUDP ON (ADUDP.CDUSER=GNR.CDUSER AND ADUDP.FGDEFAULTDEPTPOS=1) LEFT JOIN ADDEPARTMENT ADDP ON (ADDP.CDDEPARTMENT=ADUDP.CDDEPARTMENT) LEFT JOIN ADPOSITION ADP ON (ADP.CDPOSITION=ADUDP.CDPOSITION) INNER JOIN (SELECT DISTINCT Z.IDOBJECT FROM (SELECT AUXWFP.IDOBJECT FROM WFPROCESS AUXWFP INNER JOIN (SELECT PERM.USERCD, PERM.IDPROCESS, MIN(PERM.FGPERMISSION) AS FGPERMISSION FROM (SELECT WF.FGPERMISSION, WF.IDPROCESS, TM.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADTEAMUSER TM ON WF.CDTEAM=TM.CDTEAM WHERE WF.FGACCESSTYPE=1 AND TM.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE WF.FGACCESSTYPE=2 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDDEPARTMENT=UDP.CDDEPARTMENT AND WF.CDPOSITION=UDP.CDPOSITION WHERE WF.FGACCESSTYPE=3 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, UDP.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERDEPTPOS UDP ON WF.CDPOSITION=UDP.CDPOSITION WHERE WF.FGACCESSTYPE=4 AND UDP.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, WF.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF WHERE WF.FGACCESSTYPE=5 AND WF.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, US.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF CROSS JOIN ADUSER US WHERE WF.FGACCESSTYPE=6 AND US.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, RL.CDUSER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN ADUSERROLE RL ON RL.CDROLE=WF.CDROLE WHERE WF.FGACCESSTYPE=7 AND RL.CDUSER=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, WFP.CDUSERSTART AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN WFPROCESS WFP ON WFP.IDOBJECT=WF.IDPROCESS WHERE WF.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WF.FGACCESSEXCEPTION IS NULL UNION ALL SELECT WF.FGPERMISSION, WF.IDPROCESS, US.CDLEADER AS USERCD, WF.CDACCESSLIST FROM WFPROCSECURITYLIST WF INNER JOIN WFPROCESS WFP ON WFP.IDOBJECT=WF.IDPROCESS INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE WF.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WF.FGACCESSEXCEPTION IS NULL) PERM INNER JOIN WFPROCSECURITYCTRL GNASSOC ON (GNASSOC.CDACCESSLIST=PERM.CDACCESSLIST AND GNASSOC.IDPROCESS=PERM.IDPROCESS) WHERE GNASSOC.CDACCESSROLEFIELD IN (501) GROUP BY PERM.USERCD, PERM.IDPROCESS) PERMISSION ON PERMISSION.IDPROCESS=AUXWFP.IDOBJECT WHERE PERMISSION.FGPERMISSION=1 AND AUXWFP.FGSTATUS <= 5 AND (AUXWFP.FGMODELWFSECURITY IS NULL OR AUXWFP.FGMODELWFSECURITY=0) UNION ALL SELECT T.IDOBJECT FROM (SELECT MIN(PERM99.FGPERMISSION) AS FGPERMISSION, PERM99.IDOBJECT FROM (SELECT WFP.IDOBJECT, PERM1.FGPERMISSION FROM (SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, TM.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADTEAMUSER TM ON PP.CDTEAM=TM.CDTEAM WHERE PP.FGACCESSTYPE=1 AND TM.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON PP.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE PP.FGACCESSTYPE=2 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON (PP.CDDEPARTMENT=UDP.CDDEPARTMENT AND PP.CDPOSITION=UDP.CDPOSITION) WHERE PP.FGACCESSTYPE=3 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, UDP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERDEPTPOS UDP ON PP.CDPOSITION=UDP.CDPOSITION WHERE PP.FGACCESSTYPE=4 AND UDP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, PP.CDUSER AS USERCD FROM PMPROCACCESSLIST PP WHERE PP.FGACCESSTYPE=5 AND PP.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, US.CDUSER AS USERCD FROM PMPROCACCESSLIST PP CROSS JOIN ADUSER US WHERE PP.FGACCESSTYPE=6 AND US.CDUSER=15611 UNION ALL SELECT PP.FGPERMISSION, PP.CDPROC, PP.CDACCESSLIST, RL.CDUSER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN ADUSERROLE RL ON RL.CDROLE=PP.CDROLE WHERE PP.FGACCESSTYPE=7 AND RL.CDUSER=15611) PERM1 INNER JOIN PMPROCSECURITYCTRL GNASSOC ON (PERM1.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM1.CDPROC=GNASSOC.CDPROC) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACTIVITY OBJ ON GNASSOC.CDPROC=OBJ.CDACTIVITY INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PERM1.CDPROC WHERE GNCTRL.CDRELATEDFIELD IN (501) AND (OBJ.FGUSETYPEACCESS=0 OR OBJ.FGUSETYPEACCESS IS NULL) AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5 UNION ALL SELECT PERM2.IDOBJECT, PERM2.FGPERMISSION FROM (SELECT PP.FGPERMISSION, WFP.IDOBJECT, PP.CDPROC, PP.CDACCESSLIST, WFP.CDUSERSTART AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PP.CDPROC WHERE PP.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5 UNION ALL SELECT PP.FGPERMISSION, WFP.IDOBJECT, PP.CDPROC, PP.CDACCESSLIST, US.CDLEADER AS USERCD FROM PMPROCACCESSLIST PP INNER JOIN WFPROCESS WFP ON WFP.CDPROCESSMODEL=PP.CDPROC INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE PP.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WFP.FGMODELWFSECURITY=1 AND WFP.FGSTATUS <= 5) PERM2 INNER JOIN PMPROCSECURITYCTRL GNASSOC ON (PERM2.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM2.CDPROC=GNASSOC.CDPROC) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACTIVITY OBJ ON GNASSOC.CDPROC=OBJ.CDACTIVITY WHERE GNCTRL.CDRELATEDFIELD IN (501) AND (OBJ.FGUSETYPEACCESS=0 OR OBJ.FGUSETYPEACCESS IS NULL)) PERM99 WHERE 1=1 GROUP BY PERM99.IDOBJECT) T WHERE T.FGPERMISSION=1 UNION ALL SELECT PERM.IDOBJECT FROM (SELECT WFP.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADTEAMUSER TM ON PM.CDTEAM=TM.CDTEAM WHERE PM.FGACCESSTYPE=1 AND TM.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDDEPARTMENT=UDP.CDDEPARTMENT WHERE PM.FGACCESSTYPE=2 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDDEPARTMENT=UDP.CDDEPARTMENT AND PM.CDPOSITION=UDP.CDPOSITION WHERE PM.FGACCESSTYPE=3 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERDEPTPOS UDP ON PM.CDPOSITION=UDP.CDPOSITION WHERE PM.FGACCESSTYPE=4 AND UDP.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM WHERE PM.FGACCESSTYPE=5 AND PM.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM WHERE PM.FGACCESSTYPE=6 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN ADUSERROLE RL ON RL.CDROLE=PM.CDROLE WHERE PM.FGACCESSTYPE=7 AND RL.CDUSER=15611) PERM1 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM1.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM1.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM1.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND WFP.FGSTATUS <= 5 AND PMA.FGUSETYPEACCESS=1 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT WFP.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE WHERE PM.FGACCESSTYPE=8 AND PMA.CDCREATEDBY=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON DEP2.CDDEPARTMENT=DEP1.CDDEPARTMENT WHERE PM.FGACCESSTYPE=9 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON (DEP2.CDDEPARTMENT=DEP1.CDDEPARTMENT AND DEP2.CDPOSITION=DEP1.CDPOSITION) WHERE PM.FGACCESSTYPE=10 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSERDEPTPOS DEP1 ON DEP1.CDUSER=PMA.CDCREATEDBY INNER JOIN ADUSERDEPTPOS DEP2 ON DEP2.CDPOSITION=DEP1.CDPOSITION WHERE PM.FGACCESSTYPE=11 AND DEP2.CDUSER=15611 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN ADUSER US ON US.CDUSER=PMA.CDCREATEDBY WHERE PM.FGACCESSTYPE=12 AND US.CDLEADER=15611) PERM2 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM2.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM2.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM2.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND WFP.FGSTATUS <= 5 AND PMA.FGUSETYPEACCESS=1 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT PERM3.IDOBJECT FROM (SELECT PM.CDACTTYPE, PM.CDACCESSLIST, WFP.IDOBJECT FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL WHERE PM.FGACCESSTYPE=30 AND WFP.CDUSERSTART=15611 AND WFP.FGSTATUS <= 5 AND WFP.FGMODELWFSECURITY=1 UNION ALL SELECT PM.CDACTTYPE, PM.CDACCESSLIST, WFP.IDOBJECT FROM PMACTTYPESECURLIST PM INNER JOIN PMACTIVITY PMA ON PM.CDACTTYPE=PMA.CDACTTYPE INNER JOIN WFPROCESS WFP ON PMA.CDACTIVITY=WFP.CDPROCESSMODEL INNER JOIN ADUSER US ON US.CDUSER=WFP.CDUSERSTART WHERE PM.FGACCESSTYPE=31 AND US.CDLEADER=15611 AND WFP.FGSTATUS <= 5 AND WFP.FGMODELWFSECURITY=1) PERM3 INNER JOIN PMACTTYPESECURCTRL GNASSOC ON (PERM3.CDACCESSLIST=GNASSOC.CDACCESSLIST AND PERM3.CDACTTYPE=GNASSOC.CDACTTYPE) INNER JOIN PMACCESSROLEFIELD GNCTRL ON GNASSOC.CDACCESSROLEFIELD=GNCTRL.CDACCESSROLEFIELD INNER JOIN PMACCESSROLEFIELD GNCTRL_F ON GNCTRL.CDRELATEDFIELD=GNCTRL_F.CDACCESSROLEFIELD INNER JOIN PMACTIVITY PMA ON PERM3.CDACTTYPE=PMA.CDACTTYPE WHERE GNCTRL_F.CDRELATEDFIELD IN (501) AND PMA.FGUSETYPEACCESS=1) PERM UNION ALL SELECT AUXWFP.IDOBJECT FROM WFPROCESS AUXWFP INNER JOIN WFPROCSECURITYLIST WFLIST ON (AUXWFP.IDOBJECT=WFLIST.IDPROCESS) INNER JOIN WFPROCSECURITYCTRL WFCTRL ON (WFLIST.CDACCESSLIST=WFCTRL.CDACCESSLIST AND WFLIST.IDPROCESS=WFCTRL.IDPROCESS) WHERE WFCTRL.CDACCESSROLEFIELD IN (501) AND WFLIST.CDUSER=15611 AND WFLIST.FGACCESSTYPE=5 AND WFLIST.FGACCESSEXCEPTION=1 AND WFLIST.FGPERMISSION=1 AND AUXWFP.FGSTATUS <= 5) Z) MYPERM ON (WFP.IDOBJECT=MYPERM.IDOBJECT) WHERE WFP.CDPRODAUTOMATION=202 AND GNTS.DTACTUAL >= '2022-07-25' AND GNTS.DTACTUAL <= '2022-07-31'  UNION ALL SELECT GNTS.CDISOSYSTEM, GNTS.CDTIMESHEET, GNR.IDRESOURCE, GNR.NMRESOURCE, GNR.CDRESOURCE, '' AS IDTYPE, -1 AS TYPEDATA, 0 AS PLANEJADO, GNTS.DTACTUAL, GNTS.CDUSER, GNR.CDUSER AS RESOURCEUSER, GNTS.FGSTATUS, GNTS.QTSTRAIGHTMIN, GNTS.QTOVERMIN, GNTS.TMSTRAIGHTHOURS, GNTS.TMOVERHOURS, GNTS.QTTOTALMIN, 2 AS CHARGE, ADDP.IDDEPARTMENT + ' - ' + ADDP.NMDEPARTMENT AS DEPARTMENT, ADP.IDPOSITION + ' - ' + ADP.NMPOSITION AS POSITION, ADUDP.CDDEPARTMENT, ADUDP.CDPOSITION, GNA.CDGENACTIVITY AS CDACTIVITY, TSW.NMPREFIX + '-' + CAST(TST.NRTASK AS VARCHAR(255)) AS IDACTIVITY, TSW.CDWORKSPACE AS CDOBJECT, TSW.NMPREFIX AS IDOBJECT, TSW.NMWORKSPACE AS NMOBJECT, 14 AS FGACTIVITYTYPE, TST.NMTITLE AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, TST.CDTASK FROM GNACTIVITY GNA INNER JOIN WFPROCESS WFP ON (WFP.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN TSTASK TST ON (TST.IDOBJECT=WFP.IDOBJECT) INNER JOIN TSWORKSPACE TSW ON (TSW.CDWORKSPACE=TST.CDWORKSPACE) INNER JOIN TSFLOWSTEP TSFS ON (TSFS.CDFLOW=TST.CDFLOW AND TSFS.CDSTEP=TST.CDSTEP) LEFT JOIN TSSPRINT TSS ON (TSS.CDSPRINT=TST.CDSPRINT AND TSS.CDWORKSPACE=TST.CDWORKSPACE) INNER JOIN GNACTIVITYTSHEET GNATS ON (GNATS.CDGENACTIVITY=GNA.CDGENACTIVITY) INNER JOIN GNTIMESHEET GNTS ON (GNTS.CDTIMESHEET=GNATS.CDTIMESHEET) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=GNTS.CDRESOURCE) LEFT JOIN ADUSERDEPTPOS ADUDP ON (ADUDP.CDUSER=GNR.CDUSER AND ADUDP.FGDEFAULTDEPTPOS=1) LEFT JOIN ADDEPARTMENT ADDP ON (ADDP.CDDEPARTMENT=ADUDP.CDDEPARTMENT) LEFT JOIN ADPOSITION ADP ON (ADP.CDPOSITION=ADUDP.CDPOSITION) WHERE GNTS.DTACTUAL >= '2022-07-25' AND GNTS.DTACTUAL <= '2022-07-31'  UNION ALL SELECT TIMESHEET.CDISOSYSTEM, TIMESHEET.CDTIMESHEET, GNR.IDRESOURCE AS IDRESOURCE, GNR.NMRESOURCE AS NMRESOURCE, GNR.CDRESOURCE, ATITYPE.IDTASKTYPE + ' - ' + ATITYPE.NMTASKTYPE AS IDTYPE, ATI.CDTASKTYPE AS TYPEDATA, 0 AS PLANEJADO, TIMESHEET.DTACTUAL, TIMESHEET.CDUSER, GNR.CDUSER AS RESOURCEUSER, TIMESHEET.FGSTATUS, TIMESHEET.QTSTRAIGHTMIN, TIMESHEET.QTOVERMIN, TIMESHEET.TMSTRAIGHTHOURS, TIMESHEET.TMOVERHOURS, TIMESHEET.QTTOTALMIN, CASE ATI.FGCHARGE WHEN 1 THEN 1 ELSE 2 END AS CHARGE, ADDPT.IDDEPARTMENT + ' - ' + ADDPT.NMDEPARTMENT AS DEPARTMENT, ADPOS.IDPOSITION + ' - ' + ADPOS.NMPOSITION AS POSITION, ADDP.CDDEPARTMENT, ADDP.CDPOSITION, ATI.CDTASK AS CDACTIVITY, ATI.NMIDTASK AS IDACTIVITY, ATI.CDTASK AS CDOBJECT, ATI.NMIDTASK AS IDOBJECT, ATI.NMTASK AS NMOBJECT, ATI.FGTASKTYPE AS FGACTIVITYTYPE, ATI.NMTASK AS NMACTIVITY, CAST(NULL AS VARCHAR(50)) AS IDOBJECTPROCESS, CAST(NULL AS NUMERIC(10)) AS CDTASK FROM GNTIMESHEET TIMESHEET INNER JOIN PRTASKTIMESHEET TASKTIME ON (TASKTIME.CDTIMESHEET=TIMESHEET.CDTIMESHEET) INNER JOIN PRTASK ATI ON (ATI.CDTASK=TASKTIME.CDTASK) LEFT JOIN (SELECT DISTINCT PVIEW.PR_CDTASK FROM (SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDDEPARTMENT=ACCVIEW.CDDEPARTMENT  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=1 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDPOSITION=ACCVIEW.CDPOSITION  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=2 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, UDP.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADUSERDEPTPOS UDP ON UDP.CDDEPARTMENT=ACCVIEW.CDDEPARTMENT AND UDP.CDPOSITION=ACCVIEW.CDPOSITION  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=3 AND UDP.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, ACCVIEW.CDUSER FROM PRTASKACCESS ACCVIEW  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=4 AND ACCVIEW.CDUSER=15611 /*DONTREMOVE*/UNION ALL/*DONTREMOVE*/ SELECT ACCVIEW.CDTASK AS PR_CDTASK, ACCVIEW.FGACCESSCOST, TMM.CDUSER FROM PRTASKACCESS ACCVIEW INNER JOIN ADTEAMUSER TMM ON TMM.CDTEAM=ACCVIEW.CDTEAM  WHERE ACCVIEW.FGACCESS=1 AND ACCVIEW.FGTEAMMEMBER=5 AND TMM.CDUSER=15611) PVIEW WHERE 1=1) PRTASKSECURITY ON PRTASKSECURITY.PR_CDTASK=ATI.CDBASETASK AND ATI.FGRESTRICT=1 LEFT OUTER JOIN PRTASKTYPE ATITYPE ON (ATI.CDTASKTYPE=ATITYPE.CDTASKTYPE) INNER JOIN GNRESOURCEVIEW GNR ON (GNR.CDRESOURCE=TIMESHEET.CDRESOURCE) LEFT OUTER JOIN ADUSERDEPTPOS ADDP ON (GNR.CDUSER=ADDP.CDUSER AND ADDP.FGDEFAULTDEPTPOS=1) LEFT OUTER JOIN ADDEPARTMENT ADDPT ON (ADDP.CDDEPARTMENT=ADDPT.CDDEPARTMENT) LEFT OUTER JOIN ADPOSITION ADPOS ON (ADDP.CDPOSITION=ADPOS.CDPOSITION) WHERE TIMESHEET.DTACTUAL >= '2022-07-25' AND TIMESHEET.DTACTUAL <= '2022-07-31' AND ATI.FGTASKTYPE IN (2, 3) AND (( ATI.FGRESTRICT=2 OR ATI.FGRESTRICT IS NULL OR ATI.FGRESTRICT=0) OR (PRTASKSECURITY.PR_CDTASK IS NOT NULL)))TIMESHEETVIEW, GNTIMESHEET GTS LEFT JOIN ADUSER ADU ON (ADU.CDUSER=GTS.CDUSER), GNTIMEENTRY GTE WHERE TIMESHEETVIEW.CDTIMESHEET=GTS.CDTIMESHEET AND GTE.CDTIMESHEET=TIMESHEETVIEW.CDTIMESHEET AND 1=1 AND TIMESHEETVIEW.DTACTUAL >= '2022-07-25' AND TIMESHEETVIEW.DTACTUAL <= '2022-07-31'
